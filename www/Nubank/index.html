<!DOCTYPE html>
<html lang="pt-Br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apply</title>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/Library/scripts/script.padrao.js"></script>
    <script src="index.js"></script>
    <script src="/Library/class/class.padrao.js"></script>

    <!--<script src="node_modules/chart.js/dist/chart.js"></script>-->

    <script>
        var config = {};                

        var CarregaDados = async () => {
            return new Promise((resolve) => {

                var options = AjaxOptions;

                //options.url = 'https://localhost:44315/Syncronize/GET';
                options.url = 'http://apply.client/api/Syncronize/Get';
                options.onload = (xhr, obj) => {
                    
                    if (xhr.currentTarget.response != null && xhr.currentTarget.response != undefined) {
                        if (xhr.currentTarget.response.success == false) {
                            alert(`Ocorreu um erro: ${xhr.currentTarget.response.erroMsg}`);
                            resolve(null);
                        }

                        var Wallet = xhr.currentTarget.response.objeto;

                        resolve(Wallet);
                    } else {
                        alert("Nenhuma carteira foi encontrada");
                    }                    
                }

                Ajax(options);
            });            
        }

        document.addEventListener('DOMContentLoaded', async () => {
            debugger;
            var Wallet = await CarregaDados();

            var chartData = ChartData;

            var dataSet = new Array;
            var label = new Array;

            for (var i = 0; i < Wallet.cards.length; i++) {
                dataSet.push(parseFloat(Wallet.cards[i].amount.replaceAll("R$", "").replaceAll(",", ".")));
                label.push(Wallet.cards[i].timeString);
            }

            chartData.labels = label;
            chartData.datasets = [{
                label: "Cards",
                data: dataSet,
                backgroundColor: `rgb(${colorPrymary5Rgb})`,
                borderWidth: 2,
                borderColor: `rgb(${colorPrymary5Rgb})`,

            }];

            Scripts.Grafico.NewChart(Scripts.Grafico.ConfigChart('line', chartData),
                                "grafico");
        });
    </script>

    <link rel="stylesheet" href="/Library/css/style.padrao.css">
    <link rel="stylesheet" href="index.css">
</head>
<body>    
    <div class="container">
        <h1>Estatisticas</h1>
        <canvas id="grafico"></canvas>
    </div>
</body>
</html>